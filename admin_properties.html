{% extends "base.html" %}
{% block title %}Admin â€” Properties{% endblock %}
{% block content %}
<section class="admin-properties">
  <h2>Manage Submitted Properties</h2>

  {% if properties %}
    <table border="1" cellpadding="8" style="width:100%; border-collapse:collapse;">
      <thead>
        <tr>
          <th>Preview</th>
          <th>Title</th>
          <th>Owner</th>
          <th>Location</th>
          <th>Price</th>
          <th>Type / Sale</th>
          <th>Submitted</th>
          <th>Approved</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for p in properties %}
          <tr>
            <td style="width:120px; text-align:center;">
              {% set imgs = p.images | load_json %}
              {% if imgs and imgs|length > 0 %}
                <img src="{{ url_for('static', filename='uploads/' ~ imgs[0]) }}" alt="img" style="max-width:110px; max-height:70px; object-fit:cover;">
              {% else %}
                <div style="width:110px;height:70px;background:#f3f3f3;display:flex;align-items:center;justify-content:center;color:#777;">No image</div>
              {% endif %}
            </td>
            <td>{{ p.title }}</td>
            <td>
              {% if p.owner %}
                {{ p.owner.name }}<br>
                <small>{{ p.owner.email }}</small>
              {% else %}
                <small>Owner removed</small>
              {% endif %}
            </td>
            <td>{{ p.location }}</td>
            <td>Rs {{ p.price }}</td>
            <td>{{ p.property_type }} / {{ p.sale_type }}</td>
            <td>{{ p.created_at.strftime('%Y-%m-%d') }}</td>
            <td style="text-align:center;">
              {% if p.approved %}
                <span style="color:green;font-weight:600;">Approved</span>
              {% else %}
                <span style="color:orange;font-weight:600;">Pending</span>
              {% endif %}
            </td>
            <td style="white-space:nowrap;">
              <a href="{{ url_for('property_detail', prop_id=p.id) }}" class="btn">View</a>
              {% if not p.approved %}
                <a href="{{ url_for('admin_property_action', prop_id=p.id, action='approve') }}" class="btn" onclick="return confirm('Approve this property?')">Approve</a>
                <a href="{{ url_for('admin_property_action', prop_id=p.id, action='reject') }}" class="btn danger" onclick="return confirm('Reject (delete) this property?')">Reject</a>
              {% else %}
                <a href="{{ url_for('admin_property_action', prop_id=p.id, action='reject') }}" class="btn danger" onclick="return confirm('Remove approval (set rejected)?')">Remove</a>
              {% endif %}
            </td>
          </tr>
        {% endfor %}


      </tbody>

      
    </table>
  {% else %}
    <p>No submitted properties yet.</p>
  {% endif %}
</section>
{% endblock %}
